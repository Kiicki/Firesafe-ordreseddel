<!DOCTYPE html>
<html lang="no">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, interactive-widget=resizes-content">
    <title>Firesafe Ordreseddel</title>
    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/png" href="icon-192.png">
    <meta name="theme-color" content="#E8501A">
    <link rel="stylesheet" href="styles.css?v=161">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js" integrity="sha384-ZZ1pncU3bQe8y31yfZdMFdSpttDoPmOZg2wguVK9almUodir1PghgT0eY7Mrty8H" crossorigin="anonymous" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js" integrity="sha384-JcnsjUPPylna1s1fvi1u12X5qjY5OL56iySh75FdtrwhO/SWXgMjoVqcKyIIWOLk" crossorigin="anonymous" defer></script>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js" integrity="sha384-BkEIW/B4JV9w6pRfBRgZtAcYDk5goH1nUI49rLo8s5PSHgTfgxWBczRVJx+fv5kP" crossorigin="anonymous"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-auth-compat.js" integrity="sha384-96KlrabK9X4T/tq4duY+/4JE60jZAiSs4QVJFwmY30ETT24x2+89B7qmq7O4IETX" crossorigin="anonymous"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore-compat.js" integrity="sha384-LF74FIj8PQKxRVken52qSHntBSVEC6b05H04maSVJibifVGmWz9Ajc23WjrRVSCX" crossorigin="anonymous"></script>
</head>
<body>
        <div class="loading" id="loading" data-i18n="generating_file">Genererer fil...</div>

    <!-- Login Screen -->
    <div class="view" id="login-view">
        <div class="login-screen">
            <div class="login-logo">
                <h1>FIRESAFE<span class="mobile-logo-slash"></span></h1>
                <p data-i18n="form_subtitle">Ordreseddel</p>
            </div>
            <div class="login-card" id="login-card" style="display:none;">
                <div class="login-buttons">
                    <button class="login-provider-btn" onclick="signInWithGoogle()">
                        <svg width="20" height="20" viewBox="0 0 48 48"><path fill="#EA4335" d="M24 9.5c3.54 0 6.71 1.22 9.21 3.6l6.85-6.85C35.9 2.38 30.47 0 24 0 14.62 0 6.51 5.38 2.56 13.22l7.98 6.19C12.43 13.72 17.74 9.5 24 9.5z"/><path fill="#4285F4" d="M46.98 24.55c0-1.57-.15-3.09-.38-4.55H24v9.02h12.94c-.58 2.96-2.26 5.48-4.78 7.18l7.73 6c4.51-4.18 7.09-10.36 7.09-17.65z"/><path fill="#FBBC05" d="M10.53 28.59a14.5 14.5 0 010-9.18l-7.98-6.19a24.04 24.04 0 000 21.56l7.98-6.19z"/><path fill="#34A853" d="M24 48c6.48 0 11.93-2.13 15.89-5.81l-7.73-6c-2.15 1.45-4.92 2.3-8.16 2.3-6.26 0-11.57-4.22-13.47-9.91l-7.98 6.19C6.51 42.62 14.62 48 24 48z"/></svg>
                        <span data-i18n="login_google">Logg inn med Google</span>
                    </button>
                    <button class="login-provider-btn" onclick="signInWithMicrosoft()">
                        <svg width="20" height="20" viewBox="0 0 23 23"><rect x="1" y="1" width="10" height="10" fill="#f25022"/><rect x="12" y="1" width="10" height="10" fill="#7fba00"/><rect x="1" y="12" width="10" height="10" fill="#00a4ef"/><rect x="12" y="12" width="10" height="10" fill="#ffb900"/></svg>
                        <span data-i18n="login_microsoft">Logg inn med Microsoft</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div class="container form-view view" id="view-form">
        <div class="modal-content">
            <div class="modal-header" id="form-header">
                <span id="form-header-title" data-i18n="form_title">Ordreseddel</span>
            </div>

            <div id="sent-banner" class="sent-banner" style="display:none;">
            <span data-i18n="sent_banner_text">Dette skjemaet er sendt og kan ikke redigeres</span>
            <button class="sent-banner-btn" onclick="moveCurrentToSaved()" data-i18n="sent_banner_move">Flytt til lagrede</button>
        </div>

        <!-- Mobile-friendly input form -->
        <div class="mobile-form" id="mobile-form">
            <div class="mobile-section">
                <div class="mobile-field">
                    <label data-i18n="label_ordreseddel_nr">Ordreseddel nr.</label>
                    <div class="input-with-copy">
                        <input type="text" id="mobile-ordreseddel-nr" inputmode="numeric" >
                        <span class="external-badge" id="external-badge" style="display:none;" data-i18n="external_badge">Eksternt</span>
                        <button type="button" class="copy-btn" onclick="copyOrderNumber()" title="Kopier"><svg viewBox="0 0 24 24" width="18" height="18" fill="currentColor"><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/></svg></button>
                    </div>
                </div>
                <div class="mobile-field">
                    <label data-i18n="label_uke">Uke</label>
                    <input type="text" id="mobile-dato" autocapitalize="sentences">
                </div>
                <div class="mobile-field">
                    <label data-i18n="label_montor">Montør</label>
                    <input type="text" id="mobile-montor" autocapitalize="sentences">
                </div>
                <div class="mobile-field">
                    <label data-i18n="label_avdeling">Avdeling</label>
                    <input type="text" id="mobile-avdeling" inputmode="numeric" pattern="[0-9]*" autocapitalize="sentences">
                </div>
                <div class="mobile-field">
                    <label data-i18n="label_oppdragsgiver">Oppdragsgiver</label>
                    <input type="text" id="mobile-oppdragsgiver" autocapitalize="sentences">
                </div>
                <div class="mobile-field">
                    <label data-i18n="label_kundens_ref">Kundens ref.</label>
                    <input type="text" id="mobile-kundens-ref" autocapitalize="sentences">
                </div>
                <div class="mobile-field">
                    <label data-i18n="label_fakturaadresse">Fakturaadresse</label>
                    <input type="text" id="mobile-fakturaadresse" autocapitalize="sentences">
                </div>
                <div class="mobile-field">
                    <label data-i18n="label_prosjektnr">Prosjektnr.</label>
                    <input type="text" id="mobile-prosjektnr" inputmode="numeric">
                </div>
                <div class="mobile-field">
                    <label data-i18n="label_prosjektnavn">Prosjektnavn</label>
                    <input type="text" id="mobile-prosjektnavn" autocapitalize="sentences">
                </div>
            </div>

            <div class="mobile-section">
                <div class="mobile-section-title" data-i18n="section_work">Utførte arbeider</div>
                <div id="mobile-orders"></div>
                <button type="button" class="mobile-add-line-btn" onclick="addOrder()" data-i18n="order_add">+ Legg til bestilling</button>
            </div>

            <div class="mobile-section">
                <div class="mobile-section-title" data-i18n="section_signing">Signering</div>
                <div class="mobile-field">
                    <label data-i18n="label_sted">Sted</label>
                    <input type="text" id="mobile-sted" autocapitalize="sentences">
                </div>
                <div class="mobile-field">
                    <label data-i18n="label_dato">Dato</label>
                    <input type="text" id="mobile-signering-dato">
                </div>
                <div class="mobile-field">
                    <label data-i18n="label_kundens_underskrift">Kundens underskrift</label>
                    <div class="signature-preview" id="mobile-signature-preview" onclick="openSignatureOverlay()">
                        <img id="signature-preview-img" style="display:none">
                        <span class="signature-placeholder" data-i18n="signature_tap_to_sign">Trykk for å signere</span>
                    </div>
                    <input type="hidden" id="mobile-kundens-underskrift">
                </div>
            </div>

        </div>
        </div>

        <div class="form-container" id="form-container">
            <div class="form-version">GV: 9-01</div>
            <!-- Header -->
            <div class="header">
                <div class="header-left">
                    <div class="logo">
                        FIRESAFE<div class="logo-slash"></div>
                    </div>
                </div>
                <div class="header-right">
                    <div class="ordreseddel-nr-row">
                        <span class="ordreseddel-nr-label">Ordreseddel nr.:</span>
                        <input type="text" id="ordreseddel-nr" >
                    </div>
                    <div class="header-right-info">
                        <span class="left" style="font-weight: bold; font-size: 13px;">FIRESAFE AS</span><span class="right" style="font-weight: bold; font-size: 13px;">HOVEDKONTOR</span>
                        <span class="left">Postadresse</span><span class="right">Postboks 6411 Etterstad</span>
                        <span class="left"></span><span class="right">0605 Oslo</span>
                        <span class="left">Telefon</span><span class="right">09110</span>
                    </div>
                </div>
            </div>

            <!-- Oppdragsgiver / Kundens ref -->
            <div class="form-row">
                <div class="form-cell">
                    <div class="cell-label">Oppdragsgiver</div>
                    <div class="cell-input">
                        <input type="text" id="oppdragsgiver">
                    </div>
                </div>
                <div class="form-cell small">
                    <div class="cell-label">Kundens ref.</div>
                    <div class="cell-input">
                        <input type="text" id="kundens-ref">
                    </div>
                </div>
            </div>

            <!-- Fakturaadresse -->
            <div class="form-row">
                <div class="form-cell">
                    <div class="cell-label">Fakturaadresse</div>
                    <div class="cell-input">
                        <input type="text" id="fakturaadresse">
                    </div>
                </div>
            </div>

            <!-- Dato / Prosjektnr / Prosjektnavn -->
            <div class="form-row">
                <div class="form-cell" style="flex: 0 0 50%; display: flex; padding: 0;">
                    <div class="form-cell" style="flex: 0 0 105px; border-right: 1px solid #000;">
                        <div class="cell-label">Dato</div>
                        <div class="cell-input">
                            <input type="text" id="dato">
                        </div>
                    </div>
                    <div class="form-cell" style="flex: 1; border-right: none;">
                        <div class="cell-label">Prosjektnr.</div>
                        <div class="cell-input">
                            <input type="text" id="prosjektnr">
                        </div>
                    </div>
                </div>
                <div class="form-cell" style="flex: 0 0 50%;">
                    <div class="cell-label">Prosjektnavn</div>
                    <div class="cell-input">
                        <input type="text" id="prosjektnavn">
                    </div>
                </div>
            </div>

            <!-- Montør / Avdeling -->
            <div class="form-row">
                <div class="form-cell" style="flex: 1;">
                    <div class="cell-label">Montør</div>
                    <div class="cell-input">
                        <input type="text" id="montor">
                    </div>
                </div>
                <div class="form-cell" style="flex: 1;">
                    <div class="cell-label">Avdeling</div>
                    <div class="cell-input">
                        <input type="text" id="avdeling" inputmode="numeric" pattern="[0-9]*">
                    </div>
                </div>
            </div>

            <!-- Work description header -->
            <div class="work-header">
                <div class="work-header-desc">Beskrivelse av utforte arbeider</div>
                <div class="work-header-antall">Antall</div>
                <div class="work-header-enhet">Enhet</div>
            </div>

            <!-- Work lines - dynamically populated before export -->
            <div class="work-lines" id="work-lines">
            </div>

            <!-- Footer: Sted / Dato / Kundens underskrift -->
            <div class="footer-row">
                <div class="footer-cell signature-cell">
                    <div class="signature-input">
                        <input type="text" id="sted">
                    </div>
                    <div class="signature-label">Sted</div>
                </div>
                <div class="footer-cell signature-cell">
                    <div class="signature-input">
                        <input type="text" id="signering-dato">
                    </div>
                    <div class="signature-label">Dato</div>
                </div>
                <div class="footer-cell signature-cell">
                    <div class="signature-input signature-input-img">
                        <img id="desktop-signature-img">
                        <input type="hidden" id="kundens-underskrift">
                    </div>
                    <div class="signature-label">Kundens underskrift</div>
                </div>
            </div>

            <!-- Bottom text -->
            <div class="footer-bottom">
                <div class="footer-bottom-left">Original: Firesafe</div>
                <div class="footer-bottom-right">Kopi: Kunden</div>
            </div>
            <div class="footer-staples"><span class="staples-nr">42789</span> Staples - Tlf.: 02272</div>
        </div>

    </div>

    <!-- Confirmation Modal -->
    <div class="confirm-modal" id="confirm-modal" onclick="closeConfirmModal(false)">
        <div class="confirm-modal-content" onclick="event.stopPropagation()">
            <div class="confirm-modal-text" id="confirm-modal-text">Er du sikker?</div>
            <div class="confirm-modal-buttons">
                <button class="confirm-btn-cancel" onclick="closeConfirmModal(false)" data-i18n="btn_cancel">Avbryt</button>
                <button class="confirm-btn-ok" id="confirm-btn-ok" onclick="closeConfirmModal(true)">Fjern</button>
            </div>
        </div>
    </div>

    <!-- Toast notification -->
    <div class="toast" id="notification-modal" onclick="closeNotificationModal()">
        <svg class="toast-check" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg>
        <span id="notification-modal-text"></span>
    </div>

    <!-- Fullskjerm tekst-editor Modal -->
    <div class="text-editor-modal" id="text-editor-modal">
        <div class="overlay-content">
            <div class="text-editor-header">
                <span class="text-editor-title" id="text-editor-title">Beskrivelse</span>
                <button class="text-editor-done" onclick="closeTextEditor()" data-i18n="text_editor_done">Ferdig</button>
            </div>
            <textarea class="text-editor-textarea" id="text-editor-textarea" autocapitalize="sentences" data-i18n-placeholder="text_editor_placeholder" placeholder="Beskriv utført arbeid..."></textarea>
        </div>
    </div>

    <!-- Modal -->
    <div class="modal view" id="saved-modal">
        <div class="modal-content">
            <div class="sticky-header">
                <div class="modal-header">
                    <span data-i18n="modal_load_title">Hent skjema</span>
                </div>
                <div class="modal-tabs">
                    <button class="modal-tab active" onclick="switchHentTab('own')" data-i18n="tab_own">Egne</button>
                    <button class="modal-tab" onclick="switchHentTab('external')" data-i18n="tab_external">Eksterne</button>
                </div>
                <div class="modal-search" id="own-search-wrap">
                    <input type="text" id="saved-search" data-i18n-placeholder="search_placeholder" placeholder="Søk ordrenummer..." oninput="filterList('saved-list', 'saved-search')">
                </div>
                <div class="modal-search" id="external-search-wrap" style="display:none;">
                    <input type="text" id="external-search" data-i18n-placeholder="search_placeholder" placeholder="Søk ordrenummer..." oninput="filterList('external-list', 'external-search')">
                </div>
            </div>
            <div class="modal-body" id="saved-list"></div>
            <div class="modal-body" id="external-list" style="display:none;"></div>
        </div>
    </div>

    <!-- Template Modal (Home Page) -->
    <div class="modal view" id="template-modal">
        <div class="modal-content">
            <div class="sticky-header">
                <div class="top-bar">
                    <div class="btn-login logged-in" id="btn-login-home"></div>
                </div>
                <div class="template-home-wrapper">
                    <div class="mobile-form-header">
                        <h1>FIRESAFE<span class="mobile-logo-slash"></span></h1>
                        <p data-i18n="form_subtitle">Ordreseddel</p>
                        <div class="beta-label" data-i18n="beta_label">Beta</div>
                    </div>
                </div>
                <div class="modal-footer-skip" onclick="event.stopPropagation()">
                    <button class="btn-skip-template" onclick="closeTemplateModal()" data-i18n="template_new_form">Eget skjema</button>
                    <button class="btn-external-order" onclick="startExternalOrder()" data-i18n="external_order_btn">Ekstern</button>
                </div>
                <div class="modal-search">
                    <input type="text" id="template-search" data-i18n-placeholder="search_template_placeholder" placeholder="Søk prosjekt..." oninput="filterList('template-list', 'template-search')">
                </div>
            </div>
            <div class="modal-body" id="template-list"></div>
        </div>
    </div>

    <!-- Action popup -->
    <div class="confirm-modal" id="action-popup" onclick="closeActionPopup(event)">
        <div class="confirm-modal-content" onclick="event.stopPropagation()">
            <div class="confirm-modal-text" id="action-popup-title"></div>
            <div id="action-popup-buttons"></div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div class="modal view" id="settings-modal">
        <div class="modal-content">
            <div class="sticky-header">
                <div class="modal-header" id="settings-header">
                    <span id="settings-header-title" data-i18n="settings_title">Innstillinger</span>
                </div>
            </div>
            <div class="modal-body" style="padding: 16px;">
                                <!-- Hovedmeny -->
                <div id="settings-page-menu" class="settings-page">
                    <div class="settings-menu-item" onclick="showSettingsPage('ordrenr')">
                        <span data-i18n="settings_ordrenr">Ordreseddelnummer</span>
                        <span class="settings-menu-arrow">&rsaquo;</span>
                    </div>
                    <div class="settings-menu-item" onclick="showSettingsPage('defaults')">
                        <span data-i18n="settings_defaults">Standardverdier</span>
                        <span class="settings-menu-arrow">&rsaquo;</span>
                    </div>
                    <div class="settings-menu-item" onclick="showSettingsPage('materials')">
                        <span data-i18n="settings_materials">Materialer og enheter</span>
                        <span class="settings-menu-arrow">&rsaquo;</span>
                    </div>
                    <div class="settings-menu-item" onclick="showSettingsPage('required')">
                        <span data-i18n="settings_required">Obligatoriske felt</span>
                        <span class="settings-menu-arrow">&rsaquo;</span>
                    </div>
                    <div class="settings-menu-item" onclick="showSettingsPage('language')">
                        <span data-i18n="settings_language">Språk / Language</span>
                        <span class="settings-menu-arrow">&rsaquo;</span>
                    </div>
                    <div class="settings-menu-item settings-logout" onclick="handleAuth()">
                        <span data-i18n="logout">Logg ut</span>
                    </div>
                </div>

                <!-- Ordreseddelnummer-side -->
                <div id="settings-page-ordrenr" class="settings-page" style="display:none;">
                    <div class="settings-collapsible-header" onclick="toggleSettingsSection('ranges')">
                        <span><span data-i18n="settings_my_numbers">Mine numre</span> <span class="settings-collapsible-count" id="settings-count-ranges"></span></span>
                        <span class="settings-collapsible-arrow open" id="settings-arrow-ranges">&rsaquo;</span>
                    </div>
                    <div class="settings-collapsible-body open" id="settings-body-ranges">
                        <div id="settings-ranges"></div>
                        <div class="settings-add-row">
                            <input type="text" id="settings-new-start" inputmode="numeric" data-i18n-placeholder="placeholder_from" placeholder="Fra">
                            <input type="text" id="settings-new-end" inputmode="numeric" data-i18n-placeholder="placeholder_to" placeholder="Til">
                            <button type="button" class="settings-add-btn" onclick="addSettingsRange()" data-i18n="btn_add">Legg til</button>
                        </div>
                    </div>
                    <div class="settings-status" id="settings-status"></div>
                    <div class="settings-collapsible-header" onclick="toggleSettingsSection('giveaway')">
                        <span><span data-i18n="settings_given_away">Gitt bort</span> <span class="settings-collapsible-count" id="settings-count-giveaway"></span></span>
                        <span class="settings-collapsible-arrow" id="settings-arrow-giveaway">&rsaquo;</span>
                    </div>
                    <div class="settings-collapsible-body" id="settings-body-giveaway">
                        <div id="settings-given-away"></div>
                        <div class="settings-add-row">
                            <input type="text" id="settings-give-start" inputmode="numeric" data-i18n-placeholder="placeholder_from" placeholder="Fra">
                            <input type="text" id="settings-give-end" inputmode="numeric" data-i18n-placeholder="placeholder_to" placeholder="Til">
                            <button type="button" class="settings-give-btn" onclick="addGivenAwayRange()" data-i18n="settings_give_btn">Gi bort</button>
                        </div>
                    </div>
                </div>

                <!-- Standardverdier-side -->
                <div id="settings-page-defaults" class="settings-page" style="display:none;">
                    <div class="settings-defaults-grid">
                        <label class="settings-default-label"><span data-i18n="label_montor">Montør</span><input type="text" id="default-montor"></label>
                        <label class="settings-default-label"><span data-i18n="label_avdeling">Avdeling</span><input type="text" id="default-avdeling"></label>
                        <label class="settings-default-label"><span data-i18n="label_oppdragsgiver">Oppdragsgiver</span><input type="text" id="default-oppdragsgiver"></label>
                        <label class="settings-default-label"><span data-i18n="label_kundens_ref">Kundens ref.</span><input type="text" id="default-kundens-ref"></label>
                        <label class="settings-default-label"><span data-i18n="label_fakturaadresse">Fakturaadresse</span><input type="text" id="default-fakturaadresse"></label>
                        <label class="settings-default-label"><span data-i18n="label_prosjektnr">Prosjektnr.</span><input type="text" id="default-prosjektnr"></label>
                        <label class="settings-default-label"><span data-i18n="label_prosjektnavn">Prosjektnavn</span><input type="text" id="default-prosjektnavn"></label>
                        <label class="settings-default-label"><span data-i18n="label_sted">Sted</span><input type="text" id="default-sted"></label>
                    </div>
                </div>

                <!-- Materialer og enheter-side -->
                <div id="settings-page-materials" class="settings-page" style="display:none;">
                    <div class="settings-collapsible-header" onclick="toggleSettingsSection('materials')">
                        <span data-i18n="settings_materials_list">Materialer</span>
                        <span class="settings-collapsible-arrow" id="settings-arrow-materials">&rsaquo;</span>
                    </div>
                    <div class="settings-collapsible-body" id="settings-body-materials">
                        <div id="settings-material-items" class="settings-list-container"></div>
                        <div class="settings-add-row">
                            <input type="text" id="settings-new-material" data-i18n-placeholder="placeholder_new_material" placeholder="Nytt materiale" autocapitalize="sentences">
                            <button type="button" class="settings-add-btn" onclick="addSettingsMaterial()" data-i18n="btn_add">Legg til</button>
                        </div>
                    </div>
                    <div class="settings-collapsible-header" onclick="toggleSettingsSection('units')">
                        <span data-i18n="settings_units_list">Enheter</span>
                        <span class="settings-collapsible-arrow" id="settings-arrow-units">&rsaquo;</span>
                    </div>
                    <div class="settings-collapsible-body" id="settings-body-units">
                        <div id="settings-unit-items" class="settings-list-container"></div>
                        <div class="settings-add-row">
                            <input type="text" id="settings-new-unit" data-i18n-placeholder="placeholder_new_unit" placeholder="Ny enhet" autocapitalize="sentences">
                            <button type="button" class="settings-add-btn" onclick="addSettingsUnit()" data-i18n="btn_add">Legg til</button>
                        </div>
                    </div>
                </div>

                <!-- Obligatoriske felt-side -->
                <div id="settings-page-required" class="settings-page" style="display:none;">
                    <div class="settings-collapsible-header" onclick="toggleSettingsSection('required-save')">
                        <span data-i18n="settings_req_save">Lagre / Eksport</span>
                        <span class="settings-collapsible-arrow open" id="settings-arrow-required-save">&rsaquo;</span>
                    </div>
                    <div class="settings-collapsible-body open" id="settings-body-required-save">
                        <div id="settings-required-save-items" class="settings-list-container"></div>
                    </div>
                    <div class="settings-collapsible-header" onclick="toggleSettingsSection('required-template')">
                        <span data-i18n="settings_req_template">Mal</span>
                        <span class="settings-collapsible-arrow" id="settings-arrow-required-template">&rsaquo;</span>
                    </div>
                    <div class="settings-collapsible-body" id="settings-body-required-template">
                        <div id="settings-required-template-items" class="settings-list-container"></div>
                    </div>
                </div>

                <!-- Språk-side -->
                <div id="settings-page-language" class="settings-page" style="display:none;">
                    <div class="settings-lang-options" id="settings-lang-options">
                        <div class="settings-lang-option" onclick="setLanguage('no')">
                            <span>Norsk</span>
                            <span class="settings-lang-check" id="lang-check-no">&#10003;</span>
                        </div>
                        <div class="settings-lang-option" onclick="setLanguage('en')">
                            <span>English</span>
                            <span class="settings-lang-check" id="lang-check-en"></span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <!-- Material picker overlay -->
    <div class="picker-overlay" id="picker-overlay">
        <div class="overlay-content">
            <div class="picker-overlay-header">
                <button class="picker-overlay-cancel" onclick="closePickerOverlay()" data-i18n="btn_cancel">Avbryt</button>
                <span class="picker-overlay-title" data-i18n="order_materials_label">Materialer</span>
                <button class="picker-overlay-done" onclick="pickerOverlayConfirm()" data-i18n="picker_ok">Ok</button>
            </div>
            <div class="picker-overlay-list" id="picker-overlay-list"></div>
            <div class="picker-overlay-search">
                <input type="text" id="picker-overlay-search" autocapitalize="sentences" data-i18n-placeholder="placeholder_new_material" placeholder="Nytt materiale">
                <button type="button" class="picker-overlay-add-btn" id="picker-overlay-add-btn" data-i18n="btn_add">Legg til</button>
            </div>
        </div>
    </div>

    <!-- Unit picker overlay -->
    <div class="unit-picker-backdrop" id="unit-picker-overlay" onclick="if(event.target===this)closeUnitPicker()">
        <div class="unit-picker-sheet">
            <div class="unit-picker-header">
                <span data-i18n="placeholder_unit">Enhet</span>
                <div class="unit-picker-header-actions">
                    <button type="button" id="unit-picker-clear-btn" class="unit-picker-header-clear" style="display:none" data-i18n="btn_clear">Fjern</button>
                    <button type="button" onclick="closeUnitPicker()" data-i18n="btn_cancel">Avbryt</button>
                </div>
            </div>
            <div class="unit-picker-list" id="unit-picker-list"></div>
            <div class="unit-picker-custom">
                <input type="text" placeholder="Egendefinert...">
                <button type="button" class="unit-picker-custom-ok">OK</button>
            </div>
        </div>
    </div>

    <!-- Spec input popup -->
    <div class="spec-popup-backdrop" id="spec-popup" onclick="if(event.target===this)closeSpecPopup()">
        <div class="spec-popup-sheet">
            <div class="spec-popup-header">
                <span id="spec-popup-title"></span>
            </div>
            <div class="spec-popup-body">
                <input type="text" id="spec-popup-input" placeholder="f.eks. Ø50mm" autocapitalize="off">
            </div>
            <div class="spec-popup-buttons">
                <button type="button" class="spec-popup-cancel" onclick="closeSpecPopup()" data-i18n="btn_cancel">Avbryt</button>
                <button type="button" class="spec-popup-ok" onclick="confirmSpecPopup()">OK</button>
            </div>
        </div>
    </div>

    <!-- Signature overlay -->
    <div class="signature-overlay" id="signature-overlay">
        <div class="signature-overlay-header">
            <button class="signature-overlay-btn" onclick="closeSignatureOverlay()">Avbryt</button>
            <button class="signature-overlay-clear-btn" onclick="clearSignatureCanvas()">Nullstill</button>
            <button class="signature-overlay-btn signature-overlay-confirm" onclick="confirmSignature()">OK</button>
        </div>
        <canvas id="signature-canvas"></canvas>
    </div>

    <!-- Instant view routing - runs before any external scripts load -->
    <script>
    (function() {
        var v, b;
        if (!localStorage.getItem('firesafe_logged_in')) {
            v = 'login-view';
        } else {
            var h = location.hash.slice(1);
            if (h === 'hent') { v = 'saved-modal'; b = 'saved-modal-open'; }
            else if (h === 'settings') { v = 'settings-modal'; b = 'settings-modal-open'; }
            else if (h === 'skjema' || h === 'ekstern') { v = 'view-form'; }
            else { v = 'template-modal'; b = 'template-modal-open'; }
            // Show cached email immediately
            var email = localStorage.getItem('firesafe_email');
            var btn = document.getElementById('btn-login-home');
            if (email && btn) btn.textContent = email;
        }
        document.getElementById(v).classList.add('active');
        if (b) document.body.classList.add(b);
    })();
    </script>

    <!-- Toolbar - alltid sist i DOM for riktig rekkefølge når keyboard er åpen -->
    <div class="toolbar" role="toolbar" aria-label="Hovedhandlinger">
        <button class="btn-new" onclick="newForm()" data-i18n="toolbar_new">Ny</button>
        <button class="btn-save" onclick="showSaveMenu()" data-i18n="toolbar_save">Lagre</button>
        <button class="btn-load" onclick="showSavedForms()" data-i18n="toolbar_load">Hent</button>
        <button class="btn-export" onclick="showExportMenu()" data-i18n="toolbar_export">Eksport</button>
        <button class="btn-settings" onclick="showSettingsModal()"><svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg></button>
    </div>

    <script src="lang.js?v=109"></script>
    <script src="script.js?v=114"></script>
    <script src="script-ui.js?v=136"></script>
    <script>
        if ('serviceWorker' in navigator && (location.protocol === 'https:' || location.hostname === 'localhost')) {
            navigator.serviceWorker.register('service-worker.js');
        }
    </script>
</body>
</html>
